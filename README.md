# PrestaShop 9 Database Importer for 1.7.x Migrations

![PrestaShop](https://img.shields.io/badge/PrestaShop-9.0+-blue.svg)
![PHP](https://img.shields.io/badge/PHP-8.1+-purple.svg)
![License](https://img.shields.io/badge/license-AFL-green.svg)
![Version](https://img.shields.io/badge/version-1.0.0-orange.svg)

## üìã Description

**PrestaShop 9 Database Importer** is the companion module for importing database exports from PrestaShop 1.7.6/1.7.8 into PrestaShop 9.

This module works together with the [Migration Exporter Module](https://github.com/droidhispalis/Migration-Prestashop-1.7-to-9) to provide a complete migration solution.

### ‚ú® Key Features

- üì• **Direct SQL Import** - Import SQL files generated by the exporter module
- üîç **Pre-Import Diagnostics** - Verify database compatibility before importing
- üõ°Ô∏è **Safe Import Process** - Uses transactions to protect your data
- üìä **Real-time Progress** - Visual feedback during import
- ‚ö†Ô∏è **Error Handling** - Detailed error reporting and recovery options
- üîß **Post-Import Verification** - Automatic data integrity checks

---

## üéØ Complete Migration Solution

This module is **part 2** of the complete migration process:

| Step | Module | PrestaShop Version | Action |
|------|--------|-------------------|---------|
| **1** | [Migration Exporter](https://github.com/droidhispalis/Migration-Prestashop-1.7-to-9) | 1.7.6 / 1.7.8 | Export database |
| **2** | **Migration Importer** (this module) | 9.0+ | Import database |

---

## üì¶ Installation

### Requirements

- ‚úÖ PrestaShop **9.0** or higher
- ‚úÖ PHP **8.1** or higher
- ‚úÖ MySQL/MariaDB database access
- ‚úÖ Sufficient disk space for SQL file upload
- ‚úÖ `max_execution_time` = 3600 or higher (recommended)
- ‚úÖ `memory_limit` = 512M or higher (recommended)

### Installation Steps

1. **Download the module:**
   ```bash
   git clone https://github.com/droidhispalis/Migration-Prestashop-9-fro-1.7.6.git
   cd Migration-Prestashop-9-fro-1.7.6
   zip -r psimporter9from178.zip .
   ```

2. **Upload to PrestaShop 9:**
   - Go to **Modules** ‚Üí **Module Manager**
   - Click **Upload a module**
   - Select `psimporter9from178.zip`
   - Click **Install**

3. **Configure the module:**
   - Go to **Modules** ‚Üí **Module Manager**
   - Search for "PrestaShop 9 Importer"
   - Click **Configure**

---

## üöÄ Usage

### Step 1: Prepare the SQL File

First, you need to export your database from PrestaShop 1.7.x using the [Migration Exporter Module](https://github.com/droidhispalis/Migration-Prestashop-1.7-to-9).

This will generate a file like:
```
prestashop_export_2025_12_05.sql
```

### Step 2: Run Diagnostic (Recommended)

Before importing, run the diagnostic tool to verify compatibility:

1. Access the diagnostic page:
   ```
   https://your-ps9-store.com/modules/psimporter9from178/diagnostic.php
   ```

2. Review the diagnostic results:
   - ‚úÖ PHP version
   - ‚úÖ Database connection
   - ‚úÖ File permissions
   - ‚úÖ Server configuration
   - ‚úÖ Required extensions

3. Fix any issues before proceeding

### Step 3: Import Database

1. **Go to the module configuration page**
   - Modules ‚Üí Module Manager ‚Üí PrestaShop 9 Importer ‚Üí Configure

2. **Upload SQL File**
   - Click **Choose File**
   - Select your SQL export file
   - Maximum file size: Check your `upload_max_filesize` setting

3. **Start Import**
   - Click **Import Database**
   - ‚ö†Ô∏è **DO NOT CLOSE** the browser window
   - Wait for the process to complete
   - This may take 5-30 minutes depending on database size

4. **Review Results**
   - Check the import log for any errors
   - Verify imported data counts
   - Note any warnings or issues

### Step 4: Clear Cache

After successful import:

```bash
# Via SSH (recommended)
cd /path/to/your/prestashop
rm -rf var/cache/*

# Or via FTP
# Delete contents of: /var/cache/prod/ and /var/cache/dev/
```

### Step 5: Post-Import Verification

1. **Test the Back Office:**
   - Products ‚Üí Check product listings
   - Orders ‚Üí Verify order history
   - Customers ‚Üí Check customer accounts
   - Categories ‚Üí Verify category tree

2. **Test the Front Office:**
   - Browse categories
   - View product pages
   - Test search functionality
   - Check shopping cart

---

## üîß Troubleshooting

### Common Issues

#### ‚ùå Error 500 after import

**Cause:** NULL values in database fields that require strings/integers in PS 9

**Solution:** Run the SQL fix script:

1. Access phpMyAdmin
2. Select your PrestaShop 9 database
3. Execute this SQL:

```sql
-- Fix NULL values in ps_product_lang
UPDATE ps_product_lang 
SET description = COALESCE(description, ''),
    description_short = COALESCE(description_short, ''),
    link_rewrite = COALESCE(link_rewrite, 'product'),
    meta_title = COALESCE(meta_title, ''),
    meta_description = COALESCE(meta_description, '');

-- Fix NULL values in ps_product
UPDATE ps_product 
SET ean13 = COALESCE(ean13, ''),
    isbn = COALESCE(isbn, ''),
    upc = COALESCE(upc, ''),
    mpn = COALESCE(mpn, ''),
    reference = COALESCE(reference, '');

-- Clear cache
TRUNCATE TABLE ps_smarty_cache;
```

üìÑ **Complete fix available:** Check the [SQL_FIXES folder](https://github.com/droidhispalis/Migration-Prestashop-1.7-to-9/tree/main/SQL_FIXES) in the exporter module.

---

#### ‚è±Ô∏è Import timeout

**Cause:** Large database or low server limits

**Solution 1 - Increase PHP limits:**

Edit `php.ini`:
```ini
max_execution_time = 3600
max_input_time = 3600
memory_limit = 512M
upload_max_filesize = 512M
post_max_size = 512M
```

**Solution 2 - Import via command line:**

```bash
# SSH to your server
cd /path/to/prestashop
mysql -u username -p database_name < export_file.sql
```

---

#### üì¶ Upload size limit

**Cause:** SQL file larger than `upload_max_filesize`

**Solutions:**

1. **Split the SQL file:**
   ```bash
   split -l 10000 export.sql export_part_
   ```

2. **Import via phpMyAdmin:**
   - Use phpMyAdmin's import feature
   - It handles large files better

3. **Import via SSH/terminal:**
   ```bash
   mysql -u user -p database < export.sql
   ```

---

#### üîë Duplicate key errors

**Cause:** Data already exists in database

**Solution:**

The exporter module already uses `INSERT IGNORE` for critical tables. If you still get errors:

1. **Fresh installation recommended** - Start with a clean PS 9 database
2. **Manual fix** - Remove conflicting records first
3. **Contact support** - Share the error log

---

#### üñºÔ∏è Missing images

**Cause:** Images are not included in SQL export

**Solution:**

Images must be copied separately via FTP/SSH:

```bash
# From PrestaShop 1.7.x server
cd /path/to/ps1.7/
tar -czf images.tar.gz img/

# Transfer to PrestaShop 9 server
scp images.tar.gz user@ps9server:/path/to/ps9/

# Extract on PrestaShop 9
cd /path/to/ps9/
tar -xzf images.tar.gz
chown -R www-data:www-data img/
chmod -R 755 img/
```

Or use the included `img` folder structure from your export.

---

#### üëÅÔ∏è Imported products not visible in Front Office

**Cause:** Missing `ps_product_shop` records or incorrect visibility settings

**Symptoms:**
- Products appear correctly in Back Office
- Products **don't show** in Front Office (categories, search, product page)
- New products created in PS 9 work fine
- Only imported products have this issue

**Solution:**

This is the **#1 most common issue** after migration. We've created a complete fix:

1. **Run diagnostic:**
   - Download `DIAGNOSTIC_PRODUCT_VISIBILITY.sql` from the exporter repo
   - Execute in phpMyAdmin
   - Review which problems affect your products

2. **Apply automatic fix:**
   - Download `FIX_PRODUCT_VISIBILITY.sql`
   - **Make a backup first!**
   - Execute in phpMyAdmin
   - Script fixes 8 common issues automatically

3. **Clear cache (REQUIRED):**
   ```bash
   cd /path/to/prestashop
   rm -rf var/cache/*
   ```

4. **Regenerate search index:**
   - Back Office ‚Üí Preferences ‚Üí Search
   - Click "Regenerate entire index"

5. **Verify:**
   - Check products in Front Office
   - Test categories and search

üìñ **Complete guide:** See [README_PRODUCT_VISIBILITY.md](https://github.com/droidhispalis/Migration-Prestashop-1.7-to-9/blob/main/README_PRODUCT_VISIBILITY.md) in the exporter repository.

**What the fix does:**
- ‚úÖ Creates missing `ps_product_shop` records
- ‚úÖ Sets visibility to 'both'
- ‚úÖ Assigns products to categories
- ‚úÖ Generates missing link_rewrite URLs
- ‚úÖ Configures stock properly
- ‚úÖ Marks products for reindexing

---

## üìä What Gets Imported?

### Core Data ‚úÖ

- ‚úÖ Products (all attributes, combinations, features)
- ‚úÖ Categories (tree structure preserved)
- ‚úÖ Customers (accounts, addresses, groups)
- ‚úÖ Orders (full order history, details, payments)
- ‚úÖ Cart rules (discounts, vouchers)
- ‚úÖ CMS pages (content pages)
- ‚úÖ Carriers (shipping methods)
- ‚úÖ Languages (if installed in PS 9)
- ‚úÖ Currencies (if enabled in PS 9)
- ‚úÖ Manufacturers & Suppliers
- ‚úÖ Attributes & Features
- ‚úÖ Tags
- ‚úÖ Contacts
- ‚úÖ Stores

### What's NOT Imported ‚ùå

- ‚ùå Images (must be copied manually)
- ‚ùå Modules (must be reinstalled)
- ‚ùå Theme files (not compatible)
- ‚ùå Configuration settings (PS 9 config preserved)
- ‚ùå Employee accounts (security)
- ‚ùå Logs

---

## ‚öôÔ∏è Advanced Configuration

### Server Configuration

**Apache (.htaccess):**
```apache
php_value max_execution_time 3600
php_value max_input_time 3600
php_value memory_limit 512M
php_value upload_max_filesize 512M
php_value post_max_size 512M
```

**Nginx (php-fpm pool config):**
```ini
php_admin_value[max_execution_time] = 3600
php_admin_value[max_input_time] = 3600
php_admin_value[memory_limit] = 512M
php_admin_value[upload_max_filesize] = 512M
php_admin_value[post_max_size] = 512M
```

### Database Configuration

**MySQL/MariaDB optimizations:**
```sql
SET GLOBAL max_allowed_packet=1073741824;
SET GLOBAL wait_timeout=600;
SET GLOBAL interactive_timeout=600;
```

---

## üîç Diagnostic Tool

The module includes a built-in diagnostic tool accessible at:

```
https://your-store.com/modules/psimporter9from178/diagnostic.php
```

### Checks Performed:

- ‚úÖ PHP version compatibility
- ‚úÖ Database connection
- ‚úÖ Required PHP extensions
- ‚úÖ File permissions
- ‚úÖ Memory limits
- ‚úÖ Execution time limits
- ‚úÖ Upload limits
- ‚úÖ Database privileges
- ‚úÖ Disk space

---

## üìù Import Log Example

```
[2025-12-05 10:30:15] Starting import process...
[2025-12-05 10:30:16] File size: 45.3 MB
[2025-12-05 10:30:16] Checking database connection... OK
[2025-12-05 10:30:17] Starting transaction...
[2025-12-05 10:30:18] Importing categories... 150 records
[2025-12-05 10:31:45] Importing products... 3,456 records
[2025-12-05 10:35:20] Importing customers... 12,890 records
[2025-12-05 10:38:05] Importing orders... 8,234 records
[2025-12-05 10:42:30] Committing transaction...
[2025-12-05 10:42:35] Import completed successfully!
[2025-12-05 10:42:35] Total time: 12 minutes 20 seconds
```

---

## üÜò Support

### Issues & Questions

- üêõ **Bug Reports:** [Open an issue](https://github.com/droidhispalis/Migration-Prestashop-9-fro-1.7.6/issues)
- üí° **Feature Requests:** [Open an issue](https://github.com/droidhispalis/Migration-Prestashop-9-fro-1.7.6/issues)
- üìñ **Documentation:** Check the [Wiki](https://github.com/droidhispalis/Migration-Prestashop-9-fro-1.7.6/wiki)

### Related Resources

- üì§ [Migration Exporter Module](https://github.com/droidhispalis/Migration-Prestashop-1.7-to-9)
- üîß [SQL Fix Scripts](https://github.com/droidhispalis/Migration-Prestashop-1.7-to-9/tree/main/SQL_FIXES)
- üìö [PrestaShop 9 Documentation](https://devdocs.prestashop-project.org/9/)

---

## ü§ù Contributing

Contributions are welcome! Please:

1. Fork the repository
2. Create a feature branch: `git checkout -b feature/amazing-feature`
3. Commit your changes: `git commit -m 'Add amazing feature'`
4. Push to the branch: `git push origin feature/amazing-feature`
5. Open a Pull Request

---

## üìÑ License

This module is licensed under the **Academic Free License (AFL 3.0)** - same as PrestaShop.

---

## ‚ö†Ô∏è Disclaimer

**ALWAYS** test the migration on a staging/development environment before production!

- ‚úÖ Make a full backup of your PrestaShop 9 database before importing
- ‚úÖ Test thoroughly after import
- ‚úÖ Keep backups of both source and destination databases
- ‚ö†Ô∏è The authors are not responsible for data loss

---

## üéØ Migration Workflow Summary

```mermaid
graph TD
    A[PrestaShop 1.7.6/1.7.8] -->|Install Exporter Module| B[Export Database]
    B -->|Download SQL File| C[PrestaShop 9 Fresh Install]
    C -->|Install Importer Module| D[Run Diagnostic]
    D -->|All Checks Pass| E[Upload SQL File]
    E -->|Import| F[Verify Data]
    F -->|Fix Errors if needed| G[Clear Cache]
    G -->|Copy Images| H[Test Store]
    H -->|Success| I[Go Live!]
```

---

## üìä Version History

### v1.0.0 (2025-12-05)
- ‚ú® Initial release
- üì• SQL import functionality
- üîç Diagnostic tool
- üìä Progress tracking
- ‚ö†Ô∏è Error handling

---

## üôè Acknowledgments

- PrestaShop community for documentation and support
- All contributors and testers
- Users who provided feedback

---

**Made with ‚ù§Ô∏è for the PrestaShop community**

**Need help with your migration?** Open an issue or check existing discussions!
